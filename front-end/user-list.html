<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bootstrap 4 Responsive Table</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<link href="https://unpkg.com/tabulator-tables@4.2.7/dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.2.7/dist/js/tabulator.min.js"></script>

<!--Cognito JavaScript-->
<script src="js/amazon-cognito-identity.min.js"></script>  
<script src="js/config.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style type="text/css">
    img {
  vertical-align: middle;
  width: 50px;
  height: 50px;
  border-radius: 50%;
}

</style>
</head>
<body>
    <h2>User List</h2>
    <div class="table-responsive">
            <table class="table" id="tblUser">
                    <thead>
                      <tr>
                        <th>UserID</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Avatar</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      
                    </tbody>
                  </table>   
    </div>    
    <script>
	var data = { 
		UserPoolId : _config.cognito.userPoolId,
        ClientId : _config.cognito.clientId
    };
    var userPool = new AmazonCognitoIdentity.CognitoUserPool(data);
    var cognitoUser = userPool.getCurrentUser();
	
	window.onload = function(){
    if (cognitoUser != null) {
        cognitoUser.getSession(function(err, session) {
            if (err) {
                alert(err);
                return;
            }
            console.log('session validity: ' + session.isValid());
			//Set the profile info
			cognitoUser.getUserAttributes(function(err, result) {
				if (err) {
					console.log(err);
					return;
				}
				console.log(result);
				// document.getElementById("email_value").innerHTML = result[2].getValue();	
			});			
			
        });
    }
    $.ajax({
                    url:'https://oc1lgx4pq6.execute-api.ap-northeast-1.amazonaws.com/stagging/users',
					type:'GET',
					// crossDomain: true,
					// type: 'json',
					// headers: {  'Access-Control-Allow-Origin': '*' },
                    // data:{
                        // 'userid':$('#userid').val(),
                        // 'passward':$('#passward').val()
                    // }
                })
                // Ajaxリクエストが成功した時発動
                .done( (data) => {
                    console.log(data);
                    // var table = new Tabulator(".table-responsive", {
                    // layout:"fitColumns",
                    // data:data, //set initial table data
                    // columns:[
                    //     {title:"Name", field:"UserID"},
                    //     {title:"Mail", field:"Email"},
                    //     {title:"Role", field:"Role"},
                    //     {title:"Avatar", field:"AvatarUrl"},
                    // ],
                // });
                    $.each(data, function(i, obj){
                        var newRowContent = "<tr><td>"+obj.UserID+"</td><td>"+obj.Email+"</td><td>"+obj.Role+"</td><td><img src="+obj.AvatarUrl+"></td><td><button type=\"button\" class=\"btn btn-danger\" onclick=\"deleteUser()\">Delete</button></td></tr>";
                        $("#tblUser tbody").append(newRowContent);  

                    })
                })
                // Ajaxリクエストが失敗した時発動
                .fail( (data) => {
                    $('#email_value').html(data);
                    console.log(data);
                });
    }
	function signOut(){
	    if (cognitoUser != null) {
          cognitoUser.signOut();
		  window.location.href = "signout.html";
        }
	}
    </script>
  </body>
</html>
